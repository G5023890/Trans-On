# Trans-On

Trans-On - macOS-приложение для быстрого получения и перевода выделенного текста.

## Что делает приложение

- По глобальному хоткею копирует выделенный текст из активного приложения.
- Если текст не русский, пытается перевести его на русский.
- Показывает результат в плавающем полупрозрачном окне.
- Закрывает окно по `Esc`.

## Горячая клавиша

- По умолчанию: `Shift + Command + L`.
- Комбинация настраивается в меню-баре: `⌘Я -> Настройки…`.
- В настройках можно менять:
  - клавишу (`A-Z`);
  - модификаторы (`Command`, `Shift`, `Option`, `Control`);
  - размер шрифта;
  - автозапуск при входе в систему.

## Способ перевода

В меню приложения доступно переключение:

- `⌘Я -> Способ перевода -> Google Web (gtx)` (неофициальный endpoint).
- `⌘Я -> Способ перевода -> Google Cloud API` (официальный API).
- `⌘Я -> Способ перевода -> Argos (offline)` (локальный перевод через установленный Argos CLI).

Для `Google Cloud API` нужен API key. Можно задать его так:

- `⌘Я -> Способ перевода -> Google Cloud API key…`
- Ключ сохраняется в macOS Keychain.

Для `Argos (offline)` добавлен пункт:

- `⌘Я -> Способ перевода -> Проверить/обновить пакеты Argos…`
- Команда обновляет индекс Argos, проверяет обновления установленных пакетов и отдельно проверяет прямой пакет `he->ru`.
- Если `he->ru` появляется в индексе, приложение автоматически скачивает и устанавливает его, а статус сохраняется в настройках приложения.

Или через переменную окружения:

```bash
export GOOGLE_CLOUD_TRANSLATE_API_KEY="YOUR_API_KEY"
# или
export GOOGLE_API_KEY="YOUR_API_KEY"
```

## Запуск в режиме разработки

```bash
swift run
```

## Сборка и установка приложения

```bash
./scripts/build_and_install_app.sh
```

Скрипт собирает и устанавливает `/Applications/Trans-On.app`.

Особенности скрипта:
- использует стабильный `CFBundleIdentifier` и подпись `Apple Development`, чтобы не терять доверие Accessibility после каждой пересборки;
- автоматически ищет `AppIcon.icns` в проекте;
- подписывает ad-hoc только если в системе нет `Apple Development` сертификата.

## Права в macOS

Для корректной работы эмуляции `Cmd+C` и чтения выделения из других программ:

- `System Settings -> Privacy & Security -> Accessibility` - добавить терминал/приложение.
- При необходимости `Input Monitoring` - тоже добавить терминал/приложение.

Если хоткей или захват выделения не работают, сначала проверьте эти разрешения.

## Ограничения

- `Google Web (gtx)` использует неофициальный endpoint и не подходит для production.
- `Google Cloud API` требует настроенный ключ и включённый биллинг в Google Cloud.
- `Argos (offline)` требует установленный CLI и соответствующие языковые модели в `~/Library/Application Support/ArgosTranslate/packages`.
